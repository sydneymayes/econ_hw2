---
title: "Econ 204: HW 2"
author: "Sydney Mayes, Olivia Somhegyi, Rachel Spellenberg"
date: "2023-04-29"
output:  
  html_document:
    theme: simplex
    code_folding: hide
---

```{r setup,  include = TRUE, echo=TRUE, warning=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, results = FALSE)
library(tidyverse)
library(here)
library(janitor)
library(equatiomatic)
```


```{r}

# In this homework you will be simulating alternative approaches for reducing carbon emissions among four UC campuses (UCSB, UCLA, UCI, and UCD). The dataset for this assignment is available in the file “CarbonUC.csv”, available on Canvas. The dataset contains estimates of the marginal cost of reducing carbon emission for each campus for different levels of abatement (in tons of carbon). A few notes:
# ● Current (i.e. baseline) emission for each campus are: UCSB = 90,000 tons, UCLA = 250,000 tons, UCI = 100,000 tons, UCD = 160,000 tons.
# ● Prices are in $/ton and quantities are in tons of CO2.
# ● Before opening R, I recommend drawing graphs by hand to make sure you know what you want to do

# Clean and format dataset
carbon_uc <- read_csv(here('data', 'CarbonUC.csv')) %>% 
  clean_names()

long_uc <- pivot_longer(carbon_uc, cols = ucsb:ucd, names_to = 'uc', values_to = 'marginal_cost')

```


#### Question 1
For each campus, plot the marginal abatement cost data and estimate a linear regression model with
zero intercept. These estimated linear regressions will be your estimates of the marginal abatement
cost curve for each campus, which you will use for the remainder of this analysis. Write the equation
for the marginal abatement cost curve for each campus.

```{r}
# For each campus, plot the marginal abatement cost data and estimate a linear regression model with zero intercept.1 These estimated linear regressions will be your estimates of the marginal abatement cost curve for each campus, which you will use for the remainder of this analysis. Write the equation for the marginal abatement cost curve for each campus.


# Estimating linear regression models with zero intercept for each UC
# UCSB
ucsb_model <- lm(marginal_cost ~ 0 + abatement, data = filter(long_uc, uc == 'ucsb'))
#p = ucsb_model$coefficients*q
#extract_eq(ucsb_model, use_coefs = TRUE, coef_digits = 5)
# p = .001*q
ucsb_slope <- ucsb_model$coefficients
  
# UCLA
ucla_model <- lm(marginal_cost ~ 0 + abatement, data = filter(long_uc, uc == 'ucla'))
# ucla_model$coefficients
# p = .0007*q
ucla_slope <- ucla_model$coefficients

# UCI
uci_model <- lm(marginal_cost ~ 0 + abatement, data = filter(long_uc, uc == 'uci'))
# uci_model$coefficients
# p = .002 *q
uci_slope <- uci_model$coefficients

# UCD
ucd_model <- lm(marginal_cost ~ 0 + abatement, data = filter(long_uc, uc == 'ucd'))
# ucd_model$coefficients
# p = .003 *q
ucd_slope <- ucd_model$coefficients


# Plotting the marginal abatement costs data for each school
ggplot(data = long_uc, aes(x = abatement, y = marginal_cost, col = uc)) +
  geom_point() +
  geom_abline(slope = ucsb_slope) +
  geom_abline(slope = ucla_slope) +
  geom_abline(slope = uci_slope) +
  geom_abline(slope = ucd_slope) +
  #facet_wrap(~uc, ncol = 2) +
  scale_color_viridis_d() +
  labs(x = 'Tons of Carbon Abated', y = 'Price in dollars/ton of Carbon' ) +
  theme_bw()

```

##### UCSB: `r equatiomatic::extract_eq(ucsb_model, wrap = TRUE, use_coefs = TRUE, coef_digits = 5)`
##### UCLA:  `r equatiomatic::extract_eq(ucla_model, wrap = TRUE, use_coefs = TRUE, coef_digits = 5)`
##### UCI:  `r equatiomatic::extract_eq(uci_model, wrap = TRUE, use_coefs = TRUE, coef_digits = 5)`
##### UCD:  `r equatiomatic::extract_eq(ucd_model, wrap = TRUE, use_coefs = TRUE, coef_digits = 5)`


#### Question 2

Using your estimated marginal abatement cost curves, together with the baseline emissions, derive each campus’ demand curve for carbon. In other words, how much would each campus be willing to pay to emit the first ton of carbon, the second ton of carbon, etc.2 Plot each campus’ demand curve for emissions on a single graph. Which campus is willing to pay the most for the first ton of carbon emissions?

```{r}

# UCSB = 90,000 tons, UCLA = 250,000 tons, UCI = 100,000 tons, UCD = 160,000 tons.
# A = Qbar - Q

ucsb_base = 90000
ucla_base = 250000
uci_base = 100000
ucd_base = 160000

# e = amount of tons emitted

# UCSB
ucsb_price <- function(e) {
   p = ucsb_slope*(ucsb_base - e)
   return(p)
}

# UCLA
ucla_price <- function(e) {
   p = ucla_slope*(ucla_base - e)
   return(p)
}

# UCI
uci_price <- function(e) {
   p = uci_slope*(uci_base - e)
   return(p)
}

# UCD
ucd_price <- function(e) {
   p = ucd_slope*(ucd_base - e)
   return(p)
 }

demand_df <- data.frame(e = seq(0, 250000, length.out = 100)) %>% 
  mutate(ucsb_cost = pmax(0, ucsb_price(e))) %>% 
  mutate(ucla_cost = pmax(0, ucla_price(e))) %>% 
  mutate(uci_cost = pmax(0, uci_price(e))) %>% 
  mutate(ucd_cost = pmax(0, ucd_price(e)))

# e = x-axis; y = ucsb_cost

demand_df_long <- pivot_longer(demand_df, cols = ucsb_cost:ucd_cost, names_to = 'campus', values_to = 'marginal_wtp')

gg_demand <- ggplot(data = demand_df_long) +
  geom_line(aes(x = e, y = marginal_wtp, col = campus)) +
  scale_color_viridis_d() +
  labs(x = 'Tons of Carbon Emitted', y = 'Price in dollars/ton of Carbon' ) +
  theme_bw()
  
gg_demand
  

```
Based on the graph, UCD would pay the most for the first ton emitted.


